C51 COMPILER V9.51   SYSTEM                                                                11/20/2013 20:14:51 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE SYSTEM
OBJECT MODULE PLACED IN .\Output\system.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Keil\C51\BIN\C51.EXE Code\system.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\O
                    -utput\system.lst) TABS(2) OBJECT(.\Output\system.obj)

line level    source

   1          #include "system.h"
   2          #include "stc15.h"
   3          #include <intrins.h>
   4          
   5          // 软件延时
   6          void delay(uint16 n)
   7          {
   8   1        uint16 x;
   9   1        
  10   1        while(n--)
  11   1        {
  12   2          x = 5000;
  13   2          while(x--);
  14   2        }
  15   1      }
  16          
  17          
  18          //////////////////////////////////////////////////////////////
  19          //  ADC
  20          
  21          /*Define ADC operation const for ADC_CONTR*/
  22          #define ADC_POWER 0x80 //ADC power control bit
  23          #define ADC_FLAG 0x10 //ADC complete flag
  24          #define ADC_START 0x08 //ADC start control bit
  25          #define ADC_SPEEDLL 0x00 //540 clocks
  26          #define ADC_SPEEDL 0x20 //360 clocks
  27          #define ADC_SPEEDH 0x40 //180 clocks
  28          #define ADC_SPEEDHH 0x60 //90 clocks
  29          
  30          // 初始化 ADC
  31          void initADC()
  32          {
  33   1        P1ASF = 0xff;      // 设置 P1 口为 AD 口
  34   1        ADC_RES = 0;       // 清除结果寄存器
  35   1        ADC_CONTR = ADC_POWER | ADC_SPEEDLL;
  36   1        delay(2);          // ADC 上电并延时
  37   1      }
  38          
  39          // 读取 ADC 结果
  40          uint8 getADCResult(uint8 ch)
  41          {
  42   1        ADC_CONTR = ADC_POWER | ADC_SPEEDLL | ch | ADC_START;
  43   1        _nop_();
  44   1        _nop_();
  45   1        _nop_();
  46   1        _nop_();
  47   1        while(!(ADC_CONTR & ADC_FLAG));   // 等待 ADC 转换完成
  48   1        ADC_CONTR &= ~ADC_FLAG;           // 关闭 ADC
  49   1        
  50   1        return ADC_RES;                   // 返回 ADC 结果
  51   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.51   SYSTEM                                                                11/20/2013 20:14:51 PAGE 2   

   CODE SIZE        =     62    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
